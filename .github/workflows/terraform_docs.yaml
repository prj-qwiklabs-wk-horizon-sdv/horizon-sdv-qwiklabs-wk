name: tf-docs

on:
  workflow_call:
    inputs:
      terraform-path:
        required: false
        default: "./terraform"
        type: string
      output-file:
        required: false
        default: "README.md"
        type: string
      output-method:
        required: false
        default : "inject"
        type: string
      git-push:
        required: false
        default: true
        type: boolean
      config-file:
        required: false
        default : ".terraform-docs.yml"
        type: string
jobs:
  terraform-docs:
    name: terraform-docs
    runs-on: self-hosted
    permissions:
      contents: write

    steps:
    - name: Checkout source code
      uses: actions/checkout@v4.1.1

    - name: Render terraform docs inside the README.md and push changes back
      uses: terraform-docs/gh-actions@v1.0.0
      with:
        working-dir: ${{ inputs.terraform-path }}
        output-file: ${{ inputs.output-file }}
        output-method: ${{ inputs.output-method }}
        git-push: ${{ inputs.git-push }}
        config-file: ${{ inputs.config-file }}